<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Holiday Settings</title>
</head>
<body>
<script>
// ç¥æ—¥ä¸€è¦§ã‚’ç”Ÿæˆ
function getJapaneseHolidays(year) {
  let holidays = [];

  // å›ºå®šç¥æ—¥
  const fixed = [
    ["01-01", "å…ƒæ—¥"],
    ["02-11", "å»ºå›½è¨˜å¿µã®æ—¥"],
    ["02-23", "å¤©çš‡èª•ç”Ÿæ—¥"],
    ["04-29", "æ˜­å’Œã®æ—¥"],
    ["05-03", "æ†²æ³•è¨˜å¿µæ—¥"],
    ["05-04", "ã¿ã©ã‚Šã®æ—¥"],
    ["05-05", "ã“ã©ã‚‚ã®æ—¥"],
    ["08-11", "å±±ã®æ—¥"],
    ["11-03", "æ–‡åŒ–ã®æ—¥"],
    ["11-23", "å‹¤åŠ´æ„Ÿè¬ã®æ—¥"]
  ];

  // å›ºå®šç¥æ—¥ã‚’è¿½åŠ 
  fixed.forEach(([md, name]) => {
    holidays.push({ date: `${year}-${md}`, name });
  });

  // ãƒãƒƒãƒ”ãƒ¼ãƒãƒ³ãƒ‡ãƒ¼åˆ¶åº¦
  const happyMondays = [
    [1, 2, "æˆäººã®æ—¥"], // 1æœˆç¬¬2æœˆæ›œ
    [7, 3, "æµ·ã®æ—¥"],   // 7æœˆç¬¬3æœˆæ›œ
    [9, 3, "æ•¬è€ã®æ—¥"], // 9æœˆç¬¬3æœˆæ›œ
    [10, 2, "ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥"] // 10æœˆç¬¬2æœˆæ›œ
  ];

  happyMondays.forEach(([month, nth, name]) => {
    const date = getNthMonday(year, month, nth);
    holidays.push({ date, name });
  });

  // æ˜¥åˆ†ãƒ»ç§‹åˆ†ã®æ—¥ï¼ˆç°¡æ˜“è¨ˆç®—ï¼‰
  holidays.push({ date: `${year}-${calcVernalEquinox(year)}`, name: "æ˜¥åˆ†ã®æ—¥" });
  holidays.push({ date: `${year}-${calcAutumnEquinox(year)}`, name: "ç§‹åˆ†ã®æ—¥" });

  // æ—¥ä»˜é †ã«ä¸¦ã¹æ›¿ãˆ
  holidays.sort((a, b) => new Date(a.date) - new Date(b.date));

  // æŒ¯æ›¿ä¼‘æ—¥ã‚’è¿½åŠ 
  holidays = addSubstituteHolidays(holidays);

  // å›½æ°‘ã®ä¼‘æ—¥ã‚’è¿½åŠ 
  holidays = addNationalHolidays(holidays);

  return holidays;
}

// nç•ªç›®ã®æœˆæ›œæ—¥ã‚’æ±‚ã‚ã‚‹
function getNthMonday(year, month, nth) {
  const firstDay = new Date(year, month - 1, 1);
  const dayOfWeek = firstDay.getDay();
  const offset = (8 - dayOfWeek) % 7;
  const day = 1 + offset + (nth - 1) * 7;
  return `${year}-${String(month).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
}

// æ˜¥åˆ†ã®æ—¥è¨ˆç®—
function calcVernalEquinox(y) {
  let day = 20.8431 + 0.242194 * (y - 1980) - Math.floor((y - 1980) / 4);
  return `03-${String(Math.floor(day)).padStart(2, "0")}`;
}

// ç§‹åˆ†ã®æ—¥è¨ˆç®—
function calcAutumnEquinox(y) {
  let day = 23.2488 + 0.242194 * (y - 1980) - Math.floor((y - 1980) / 4);
  return `09-${String(Math.floor(day)).padStart(2, "0")}`;
}

// æŒ¯æ›¿ä¼‘æ—¥è¿½åŠ ï¼ˆæ—¥æ›œã«ç¥æ—¥ãŒã‚ã£ãŸå ´åˆã€æ¬¡ã®å¹³æ—¥ï¼‰
function addSubstituteHolidays(holidays) {
  const result = [...holidays];
  holidays.forEach(h => {
    const date = new Date(h.date);
    if (date.getDay() === 0) { // æ—¥æ›œ
      let substitute = new Date(date);
      substitute.setDate(date.getDate() + 1);
      while (result.find(r => r.date === formatDate(substitute))) {
        substitute.setDate(substitute.getDate() + 1);
      }
      result.push({ date: formatDate(substitute), name: "æŒ¯æ›¿ä¼‘æ—¥" });
    }
  });
  result.sort((a, b) => new Date(a.date) - new Date(b.date));
  return result;
}

// å›½æ°‘ã®ä¼‘æ—¥è¿½åŠ ï¼ˆç¥æ—¥ã«æŒŸã¾ã‚ŒãŸå¹³æ—¥ï¼‰
function addNationalHolidays(holidays) {
  const result = [...holidays];
  for (let i = 0; i < holidays.length - 1; i++) {
    const d1 = new Date(holidays[i].date);
    const d2 = new Date(holidays[i + 1].date);
    if ((d2 - d1) / (1000 * 60 * 60 * 24) === 2) {
      const mid = new Date(d1);
      mid.setDate(mid.getDate() + 1);
      if (mid.getDay() !== 0 && mid.getDay() !== 6) { // å¹³æ—¥
        result.push({ date: formatDate(mid), name: "å›½æ°‘ã®ä¼‘æ—¥" });
      }
    }
  }
  result.sort((a, b) => new Date(a.date) - new Date(b.date));
  return result;
}

// æ—¥ä»˜ã‚’ YYYY-MM-DD å½¢å¼ã«
function formatDate(d) {
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
}

// ğŸ¯ 2025å¹´6æœˆï½2035å¹´12æœˆã®ç¥æ—¥ãƒªã‚¹ãƒˆä½œæˆ
const allHolidays = [];
for (let y = 2025; y <= 2075; y++) {
  const startMonth = (y === 2025) ? 6 : 1;
  const endMonth = (y === 2035) ? 12 : 12;
  getJapaneseHolidays(y).forEach(h => {
    const month = parseInt(h.date.split("-")[1], 10);
    if (month >= startMonth && month <= endMonth) {
      allHolidays.push(h);
    }
  });
}

// JSONã¨ã—ã¦å‡ºåŠ›ï¼ˆfetchã§èª­ã¿è¾¼ã‚€æƒ³å®šï¼‰
document.write(`<pre>${JSON.stringify({ holidays: allHolidays }, null, 2)}</pre>`);

</script>
</body>
</html>
